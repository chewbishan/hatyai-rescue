<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hatyai Flood Rescue Registry</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ðŸš¨ REPLACE THIS WITH YOUR ACTUAL GOOGLE SCRIPT URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';

        function RescueFormApp() {
            const [entries, setEntries] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");
            const [loading, setLoading] = useState(false);
            const [debugInfo, setDebugInfo] = useState('');
            const [form, setForm] = useState({
                hotel: "Test Hotel", 
                hotel_address: "Test Address",
                room: "101", 
                pax: "2", 
                ages: "30,35", 
                baby_elderly: "no", 
                phone: "0123456789", 
                supplies: "3 days", 
                power: "yes", 
                medical: "none", 
                evacuation: "yes", 
                nationality: "Thai",
                remarks: "Test entry"
            });

            // Test connection first
            const testConnection = async () => {
                try {
                    setDebugInfo('Testing connection...');
                    const response = await fetch(GOOGLE_SCRIPT_URL);
                    const data = await response.json();
                    setDebugInfo('âœ… Connection successful: ' + JSON.stringify(data));
                    return true;
                } catch (error) {
                    setDebugInfo('âŒ Connection failed: ' + error.message);
                    return false;
                }
            };

            useEffect(() => {
                testConnection();
            }, []);

            const handleChange = (e) => {
                setForm({ ...form, [e.target.name]: e.target.value });
            };

            const handleSearchChange = (e) => {
                setSearchTerm(e.target.value);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                try {
                    setLoading(true);
                    setDebugInfo('Submitting data...');
                    
                    // Create form data
                    const formData = new FormData();
                    Object.keys(form).forEach(key => {
                        formData.append(key, form[key]);
                    });
                    
                    setDebugInfo('Sending to: ' + GOOGLE_SCRIPT_URL);
                    
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    setDebugInfo('Response: ' + JSON.stringify(result));
                    
                    if (result.success) {
                        alert("âœ… Data saved to Google Sheets successfully!");
                        // Reset form
                        setForm({
                            hotel: "", hotel_address: "", room: "", pax: "", ages: "", 
                            baby_elderly: "", phone: "", supplies: "", power: "", 
                            medical: "", evacuation: "", nationality: "", remarks: ""
                        });
                    } else {
                        alert("âŒ Error: " + (result.error || 'Unknown error'));
                    }
                } catch (error) {
                    setDebugInfo('âŒ Network error: ' + error.message);
                    alert("âŒ Network error. Please check:\n1. Internet connection\n2. Google Script URL\n3. Try again");
                } finally {
                    setLoading(false);
                }
            };

            const generateQRCode = () => {
                const currentUrl = window.location.href;
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(currentUrl)}`;
                
                return (
                    React.createElement('div', { className: 'mt-4 p-4 border rounded-lg bg-white' },
                        React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, 'Share this App'),
                        React.createElement('img', { 
                            src: qrCodeUrl, 
                            alt: 'QR Code', 
                            className: 'mx-auto border rounded' 
                        }),
                        React.createElement('p', { className: 'text-xs text-gray-500 mt-2 text-center break-all' }, currentUrl)
                    )
                );
            };

            return (
                React.createElement('div', { className: 'p-6 max-w-4xl mx-auto' },
                    // Title
                    React.createElement('h1', { className: 'text-3xl font-bold mb-4' }, 'Hatyai Flood Rescue Registry'),
                    
                    // Debug Info
                    React.createElement('div', { className: 'mb-4 p-3 bg-gray-100 border rounded-lg' },
                        React.createElement('h3', { className: 'font-semibold mb-2' }, 'Connection Status:'),
                        React.createElement('p', { className: 'text-sm font-mono' }, debugInfo || 'Testing connection...')
                    ),
                    
                    // Quick Test Form
                    React.createElement('div', { className: 'mb-6 p-4 bg-blue-50 rounded-lg' },
                        React.createElement('h3', { className: 'font-semibold mb-2' }, 'Quick Test:'),
                        React.createElement('p', { className: 'text-sm mb-2' }, 'Click "Submit Test Data" to verify Google Sheets connection'),
                        React.createElement('button', {
                            onClick: handleSubmit,
                            disabled: loading,
                            className: `px-4 py-2 rounded ${loading ? 'bg-gray-400' : 'bg-green-600 hover:bg-green-700'} text-white` 
                        }, loading ? 'Submitting...' : 'Submit Test Data')
                    ),
                    
                    // QR Code
                    generateQRCode(),

                    // Main Form
                    React.createElement('form', { onSubmit: handleSubmit, className: 'grid grid-cols-1 md:grid-cols-2 gap-3 mb-8 mt-6' },
                        // Form inputs
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Hotel Name', 
                            name: 'hotel', 
                            value: form.hotel, 
                            onChange: handleChange
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Hotel Address', 
                            name: 'hotel_address', 
                            value: form.hotel_address, 
                            onChange: handleChange 
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Room Number', 
                            name: 'room', 
                            value: form.room, 
                            onChange: handleChange
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Number of Pax', 
                            name: 'pax', 
                            value: form.pax, 
                            onChange: handleChange
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Ages (e.g., 35,42,8)', 
                            name: 'ages', 
                            value: form.ages, 
                            onChange: handleChange 
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Baby/Elderly (yes/no)', 
                            name: 'baby_elderly', 
                            value: form.baby_elderly, 
                            onChange: handleChange 
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Phone Number', 
                            name: 'phone', 
                            value: form.phone, 
                            onChange: handleChange
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Water/Food Left (days)', 
                            name: 'supplies', 
                            value: form.supplies, 
                            onChange: handleChange 
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Power Status', 
                            name: 'power', 
                            value: form.power, 
                            onChange: handleChange 
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Medical Needs', 
                            name: 'medical', 
                            value: form.medical, 
                            onChange: handleChange 
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Evacuation Needed (yes/no)', 
                            name: 'evacuation', 
                            value: form.evacuation, 
                            onChange: handleChange 
                        }),
                        React.createElement('input', { 
                            className: 'p-2 border rounded', 
                            placeholder: 'Nationality', 
                            name: 'nationality', 
                            value: form.nationality, 
                            onChange: handleChange
                        }),
                        React.createElement('textarea', { 
                            className: 'md:col-span-2 p-2 border rounded', 
                            placeholder: 'Remarks / Additional Information', 
                            name: 'remarks', 
                            value: form.remarks, 
                            onChange: handleChange,
                            rows: 3 
                        }),
                        React.createElement('div', { className: 'md:col-span-2' },
                            React.createElement('button', { 
                                type: 'submit',
                                disabled: loading,
                                className: `p-2 rounded w-full ${loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'} text-white` 
                            }, loading ? 'Submitting...' : 'Submit Registration')
                        )
                    )
                )
            );
        }

        ReactDOM.render(React.createElement(RescueFormApp), document.getElementById('root'));
    </script>
</body>
</html>
